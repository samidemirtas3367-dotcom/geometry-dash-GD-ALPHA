<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GD ALPHA - Mobil Optimize</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Arial Black', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; touch-action: none; }
        #gameWrapper { position: relative; width: 800px; height: 400px; border: 4px solid #333; max-width: 100vw; max-height: 50vw; background: #001f3f; overflow: hidden; }
        canvas { display: block; width: 100%; height: 100%; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background: rgba(0,0,0,0.85); color: white; z-index: 100; text-align: center; }
        .hidden { display: none !important; }
        h1 { font-size: clamp(30px, 8vw, 60px); color: #00fff2; text-shadow: 0 0 20px #00fff2; margin: 0; }
        .btn { padding: 15px 40px; margin: 10px; font-size: 20px; cursor: pointer; background: #00fff2; border: none; font-weight: bold; border-radius: 8px; width: 220px; }
        #stats { position: absolute; top: 10px; left: 10px; color: white; font-size: 18px; z-index: 50; pointer-events: none; }
    </style>
</head>
<body>

<div id="gameWrapper">
    <div id="stats">üí∞ <span id="coinDisplay">0</span> | üèÜ <span id="scoreDisplay">0</span></div>
    <div id="mainMenu" class="overlay">
        <h1>GD ALPHA</h1>
        <button class="btn" onclick="startGame()">OYUNA BA≈ûLA</button>
        <button class="btn" onclick="openShop()" style="background:#ff00ff">MAƒûAZA</button>
    </div>
    <div id="shopMenu" class="overlay hidden">
        <h2>SKƒ∞N SE√á</h2>
        <div id="shopGrid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;"></div>
        <button class="btn" onclick="closeShop()">GERƒ∞</button>
    </div>
    <canvas id="gameCanvas"></canvas>
</div>

<audio id="bgMusic" loop><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg"></audio>

<script>
    let canvas = document.getElementById("gameCanvas"), ctx = canvas.getContext("2d");
    let music = document.getElementById("bgMusic");
    canvas.width = 800; canvas.height = 400;

    let coins = parseInt(localStorage.getItem("gd_coins_alpha")) || 0;
    let unlocked = JSON.parse(localStorage.getItem("gd_skins_alpha")) || ["#00fff2-hollow"];
    let currentSkin = { color: "#00fff2", type: "hollow" };
    
    let isPlaying = false, isFlying = false, isHardMode = false, isTouching = false;
    let score = 0, speed = 4.8, gravity = 0.8; 
    let player = { x: 120, y: 300, w: 32, h: 32, dy: 0, rot: 0, grounded: false };
    let obstacles = [], spawnTimer = 0;

    function setupControls() {
        const startAction = (e) => { e.preventDefault(); isTouching = true; if(isPlaying) music.play().catch(()=>{}); };
        const endAction = (e) => { e.preventDefault(); isTouching = false; };
        window.onkeydown = (e) => { if(e.code === "Space") isTouching = true; };
        window.onkeyup = (e) => { if(e.code === "Space") isTouching = false; };
        canvas.addEventListener("touchstart", startAction, {passive: false});
        canvas.addEventListener("touchend", endAction, {passive: false});
        canvas.addEventListener("mousedown", startAction);
        canvas.addEventListener("mouseup", endAction);
    }
    setupControls();

    function drawPlayer(x, y, size, color, type) {
        ctx.save();
        ctx.translate(x + size/2, y + size/2);
        ctx.rotate(player.rot);
        ctx.fillStyle = color;
        ctx.fillRect(-size/2, -size/2, size, size);
        ctx.strokeStyle = "white"; ctx.lineWidth = 2; ctx.strokeRect(-size/2, -size/2, size, size);
        ctx.fillStyle = "black";
        if (type === "hollow") ctx.fillRect(-size/4, -size/4, size/2, size/2);
        else if (type === "smile") { ctx.fillRect(-8, -8, 4, 4); ctx.fillRect(4, -8, 4, 4); ctx.stroke(); } // √áizim basitle≈ütirildi
        ctx.restore();
    }

    function spawn() {
        spawnTimer++;
        let limit = isHardMode ? 25 : 42; 
        if (spawnTimer > limit) {
            if (score === 20) obstacles.push({ x: 800, y: 100, w: 50, h: 200, type: "portal", color: "#0ff00" });
            else if (score === 40) obstacles.push({ x: 800, y: 100, w: 50, h: 200, type: "portal", color: "#00f" });
            else {
                if (isFlying) {
                    let gap = 165, h = Math.random() * 150 + 50;
                    obstacles.push({ x: 800, y: 0, w: 50, h: h, type: "wall" });
                    obstacles.push({ x: 800, y: h + gap, w: 50, h: 400, type: "wall" });
                } else {
                    let r = Math.random();
                    if (r < 0.4) obstacles.push({ x: 800, y: 338, w: 32, h: 32, type: "spike" });
                    else obstacles.push({ x: 800, y: 275, w: 180, h: 22, type: "platform" });
                }
            }
            spawnTimer = 0;
        }
    }

    function gameLoop() {
        if (!isPlaying) return;
        ctx.clearRect(0, 0, 800, 400);
        let bg = isFlying ? "#002400" : (isHardMode ? "#400" : "#001f3f");
        document.getElementById("gameWrapper").style.background = bg;
        ctx.fillStyle = "#111"; ctx.fillRect(0, 370, 800, 30);

        if (isFlying) {
            player.dy += isTouching ? -1.0 : 0.6; // Mobilde daha yumu≈üak u√ßu≈ü
            player.dy *= 0.94;
            player.rot = player.dy * 0.05;
        } else {
            player.dy += gravity;
            if (isTouching && player.grounded) player.dy = -13;
            if (!player.grounded) player.rot += 0.15; else player.rot = 0;
        }

        player.y += player.dy;
        player.grounded = false;

        if (player.y + player.h > 370) { player.y = 370 - player.h; player.dy = 0; player.grounded = true; }
        if (player.y < 0) { player.y = 0; player.dy = 0; if(isFlying) gameOver(); }

        spawn();

        obstacles.forEach((obj, i) => {
            obj.x -= speed;
            let p = player;
            
            // MOBƒ∞L TOLERANSLI √áARPI≈ûMA (Hitbox %15 k√º√ß√ºlt√ºld√º)
            let hitboxPadding = 4;
            if (p.x + hitboxPadding < obj.x + obj.w - hitboxPadding && 
                p.x + p.w - hitboxPadding > obj.x + hitboxPadding && 
                p.y + hitboxPadding < obj.y + obj.h - hitboxPadding && 
                p.y + p.h - hitboxPadding > obj.y + hitboxPadding) {
                
                if (obj.type === "spike" || obj.type === "wall") gameOver();
                else if (obj.type === "portal") {
                    if (obj.color === "#0ff00") isFlying = true;
                    else { isFlying = false; isHardMode = true; speed = 7.0; }
                    obstacles.splice(i, 1);
                }
                else if (obj.type === "platform") {
                    if (p.y + p.h < obj.y + 25 && p.dy >= 0) { p.y = obj.y - p.h; p.dy = 0; p.grounded = true; }
                    else { gameOver(); }
                }
            }

            if (obj.type === "spike") {
                ctx.fillStyle = isHardMode ? "#f00" : "#ff2e63";
                ctx.beginPath(); ctx.moveTo(obj.x, obj.y+32); ctx.lineTo(obj.x+16, obj.y); ctx.lineTo(obj.x+32, obj.y+32); ctx.fill();
            } else if (obj.type === "portal") {
                ctx.fillStyle = obj.color; ctx.fillRect(obj.x, obj.y, obj.w, obj.h);
            } else {
                ctx.fillStyle = isHardMode ? "#900" : (obj.type === "wall" ? "#333" : "#00fff2");
                ctx.fillRect(obj.x, obj.y, obj.w, obj.h);
            }

            if (obj.x + obj.w < 0) {
                obstacles.splice(i, 1); score++; 
                if(score%5===0){ coins+=2; if(!isHardMode) speed+=0.04; }
                updateUI();
            }
        });

        drawPlayer(player.x, player.y, player.w, currentSkin.color, currentSkin.type);
        requestAnimationFrame(gameLoop);
    }

    function gameOver() { isPlaying = false; music.pause(); document.getElementById("mainMenu").classList.remove("hidden"); document.querySelector("h1").innerText = "SKOR: " + score; }
    function startGame() { document.getElementById("mainMenu").classList.add("hidden"); score = 0; speed = 4.8; obstacles = []; isFlying = false; isHardMode = false; player.y = 300; player.dy = 0; isPlaying = true; updateUI(); gameLoop(); }
    function updateUI() { document.getElementById("coinDisplay").innerText = coins; document.getElementById("scoreDisplay").innerText = score; localStorage.setItem("gd_coins_alpha", coins); localStorage.setItem("gd_skins_alpha", JSON.stringify(unlocked)); }
    function openShop() { 
        document.getElementById("mainMenu").classList.add("hidden"); document.getElementById("shopMenu").classList.remove("hidden");
        const grid = document.getElementById("shopGrid"); grid.innerHTML = "";
        shopItems.forEach(item => {
            const id = `${item.color}-${item.type}`, isOwned = unlocked.includes(id);
            grid.innerHTML += `<div style="background:#222; padding:10px; border-radius:5px; border:1px solid ${currentSkin.type===item.type?'#00fff2':'#444'}">
                <div style="width:25px; height:25px; background:${item.color}; margin:auto; border:1px solid white;"></div>
                <button onclick="buySkin('${item.color}', '${item.type}', ${item.price})" style="margin-top:5px; width:100%">${isOwned ? 'SE√á' : item.price+'üí∞'}</button>
            </div>`;
        });
    }
    function buySkin(c, t, p) { const id = `${c}-${t}`; if(unlocked.includes(id)) currentSkin = {color:c, type:t}; else if(coins>=p) { coins-=p; unlocked.push(id); currentSkin = {color:c, type:t}; } updateUI(); openShop(); }
    function closeShop() { document.getElementById("shopMenu").classList.add("hidden"); document.getElementById("mainMenu").classList.remove("hidden"); }
</script>
</body>
</html>
